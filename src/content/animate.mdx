### Framer Motion & GSAP

- [Framer Motion](https://motion.dev/docs) v12.22.0
- [GSAP](https://gsap.com/docs/v3/) v3.13.0

GSAP 一个老牌的动画库，兼容性好，方便易用，功能强大，最近把付费的插件什么的开源了，目前依旧是最好的选择。

越来越多的开源库，开源项目使用 Framer Motion 来实现动画效果，Framer Motion 变得越来越重要。

动画能让用户有更好的体验，而好看酷炫的动画不仅跟设计师有关，也跟我们前端息息相关，普通的设计师往往没有太多动画的灵感，或者想出的方案我们不太好实现，不如自己提需求，依靠自己的经验去 push 做出合理好看的动画。

### imber Animation

[imber Animation](https://imber-animation.netlify.app/) 是动画 Demo 展示，里面有各种动画效果可以参考，文章下面的所有动画效果，都可以在 [Github 源码仓库](https://github.com/imberZsk/animation) 找到，动画的右上角有查看源码功能，并且封装实现方便开箱即用，封装的组件在项目的 [components](https://github.com/imberZsk/animation/tree/main/src/components) 目录下，网站大部分动画都用 GSAP 和 Framer Motion 实现过。

<a href="https://imber-animation.netlify.app/" target="_blank" rel="noopener noreferrer" alt="imber Animation">
  <img src="/posts/animate/screenshot.png" alt="imber Animation" />
</a>

### 文字拆分动画（Split）

GSAP 开源后的 SplitText 插件，实现文字拆分动画非常方便，注意在完成时 revert，减少后续性能开销。

[animation - split](https://imber-animation.netlify.app/animations/split)

<video src="/posts/animate/split.mov" controls />

组件代码

```tsx
'use client'

import { gsap } from 'gsap'
import { useGSAP } from '@gsap/react'
import { SplitText } from 'gsap/SplitText'
import { useRef } from 'react'

gsap.registerPlugin(SplitText)

interface SplitTextGsapProps {
  text: string
  className?: string
}

const SplitTextGsap = ({ text, className }: SplitTextGsapProps) => {
  const gsapTextRef = useRef<HTMLDivElement>(null)
  useGSAP(() => {
    if (gsapTextRef.current) {
      let split = new SplitText(gsapTextRef.current, { type: 'chars,words' })

      gsap.from(split.chars, {
        autoAlpha: 0,
        yPercent: 'random([-100,100])',
        rotation: 'random([-30,30])',
        ease: 'back.out',
        // repeat: -1,
        // yoyo: true,
        stagger: {
          amount: 0.5,
          from: 'random'
        },
        onComplete: () => {
          split.revert()
        }
      })
    }
  })

  return (
    <div className={`${className}`} ref={gsapTextRef}>
      {text}
    </div>
  )
}

export default SplitTextGsap
```

### 文字高斯模糊动画（Blur）

博客首页的文字高斯模糊动画，也是使用 GSAP 的 SplitText 插件实现，核心逻辑和上面差不多，主要使用 blur 去做每个字的效果。

[animation - blur](https://imber-animation.netlify.app/animations/blur)

<video src="/posts/animate/blur.mov" controls />

组件代码

```tsx
'use client'

import React, { useRef } from 'react'
import { gsap } from 'gsap'
import { useGSAP } from '@gsap/react'
import { SplitText } from 'gsap/SplitText'

// 注册SplitText插件
gsap.registerPlugin(SplitText)

interface BlurTextGsapProps {
  text?: string
  children?: React.ReactNode
  delay?: number
  className?: string
  animateBy?: 'words' | 'chars'
  direction?: 'top' | 'bottom'
  onAnimationComplete?: () => void
  ease?: string
}

const BlurTextGsap = ({
  text = '',
  children,
  delay = 50, // 默认更快的delay，像React Spring版本
  className = '',
  animateBy = 'words',
  direction = 'top',
  onAnimationComplete,
  ease = 'none' // 使用linear ease让动画更匀速
}: BlurTextGsapProps) => {
  const containerRef = useRef<HTMLParagraphElement>(null)
  const splitRef = useRef<SplitText | null>(null)

  useGSAP(() => {
    if (!containerRef.current) return

    // 使用SplitText拆分文字
    splitRef.current = new SplitText(containerRef.current, {
      type: animateBy
    })

    const elements = splitRef.current[animateBy] as HTMLElement[]

    // 设置初始状态 - 更接近React Spring版本
    gsap.set(elements, {
      filter: 'blur(10px)',
      opacity: 0,
      y: 0, // 移除y轴移动，更专注于模糊效果
      willChange: 'transform, filter, opacity'
    })

    // 创建时间线动画
    const tl = gsap.timeline({
      onComplete: onAnimationComplete
    })

    // 第一阶段：从完全模糊到半模糊
    tl.to(elements, {
      filter: 'blur(5px)',
      opacity: 0.5,
      y: 0,
      stagger: {
        amount: (elements.length * delay) / 1000, // 使用amount而不是each来控制总时间
        ease: 'none' // stagger也使用linear
      },
      ease: ease
    }).to(elements, {
      filter: 'blur(0px)',
      opacity: 1,
      stagger: {
        amount: (elements.length * delay) / 1000,
        ease: 'none'
      },
      ease: ease
    })

    return () => {
      // 清理SplitText实例
      splitRef.current?.revert()
    }
  }, [text, children, delay, animateBy, direction, onAnimationComplete, ease])

  return (
    <p ref={containerRef} className={`${className}`}>
      {children || text}
    </p>
  )
}

export default BlurTextGsap
```

### 数字递增动画（Add）

GSAP 的 textContent 和 roundProps，可以很方便实现这个效果，Framer Motion 同样简单。

[animation - add](https://imber-animation.netlify.app/animations/add)

<video src="/posts/animate/add.mov" controls />

组件代码 GSAP

```tsx
'use client'

import React, { useRef } from 'react'
import gsap from 'gsap'
import { useGSAP } from '@gsap/react'

const AddTextGsap = ({ from, to, className }: { from: number; to: number; className: string }) => {
  const ref = useRef<HTMLHeadingElement>(null)
  useGSAP(() => {
    gsap.to(ref.current, {
      textContent: to,
      duration: 1,
      ease: 'power2.inOut',
      roundProps: 'textContent'
    })
  })

  return (
    <h1 ref={ref} className={className}>
      {from}
    </h1>
  )
}

export default AddTextGsap
```

组件代码 Framer Motion

```tsx
'use client'

import { motion, useMotionValue, useTransform, animate } from 'framer-motion'
import { useEffect } from 'react'

const AddTextFramer = ({ from, to, className }: { from: number; to: number; className: string }) => {
  const count = useMotionValue(from)
  const rounded = useTransform(count, (latest) => Math.round(latest))

  useEffect(() => {
    const animation = animate(count, to, {
      duration: 1,
      ease: 'easeInOut'
    })

    return animation.stop
  }, [count, to])

  return (
    <motion.h1 transition={{ duration: 1, ease: 'easeInOut' }} className={className}>
      <motion.span>{rounded}</motion.span>
    </motion.h1>
  )
}

export default AddTextFramer
```

### 错开动画（Stagger）

gsap 使用 stagger 错开动画，framer motion 使用 transition 的 delay 错开动画。

[animation - stagger](https://imber-animation.netlify.app/animations/stagger/framer)

<video src="/posts/animate/stagger.mov" controls />

核心逻辑

```tsx
// gsap
gsap.from('.stagger-item', {
  opacity: 0,
  y: 15,
  stagger: 0.1,
  duration: 0.4
})

// framer motion
{
  postsConfig.map((post, index) => (
    <motion.div
      key={index}
      initial={{ opacity: 0, y: 15 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, delay: index * 0.1 }}
    ></motion.div>
  ))
}
```

### 时间轴动画（Timeline）

- 应用：入场动画，各种有顺序动画

做一些简单有执行顺序的动画，比如入场动画片，GSAP 有 timeline 时间线，让动画依次执行，而 Framer Motion 可以设置 delay。

[animation - timeline](https://imber-animation.netlify.app/animations/timeline/gsap)

<video src="/posts/animate/timeline.mov" controls />

核心逻辑

```tsx
import { motion } from 'framer-motion'
import Image from 'next/image'

const Framer = () => {
  return (
    <section className="min-h-screen overflow-x-hidden bg-black pt-52 text-center text-white">
      <div className="absolute top-32 left-1/2 z-10 -translate-x-1/2">
        <motion.div
          initial={{ opacity: 0, y: 30 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.8 }}
          className="z-10 mx-auto mb-10"
        >
          <Image src="https://fms.res.meizu.com/dms/2023/03/29/221febae-e651-410a-903f-29e0bd051ac7.png" />
        </motion.div>

        <MotionImage
          src="https://fms.res.meizu.com/dms/2023/03/29/399cc024-ff70-4cf2-8011-5b86e6313b1f.png"
          alt="framer motion"
          width={548}
          height={80}
          className="title2"
          containerClassName="z-10"
          initial={{ scale: 5, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ duration: 0.8 }}
        />
      </div>

      <motion.div
        initial={{ x: '10%', opacity: 0 }}
        animate={{ x: 0, opacity: 1 }}
        transition={{ duration: 1, delay: 1.3 }}
      >
        <Image src="https://fms.res.meizu.com/dms/2023/05/24/a8ee0203-5636-4b61-b6bf-7e66b5f671b5.jpg" />
      </motion.div>
    </section>
  )
}

export default Framer
```

### React 退出动画（Exit）

- 应用：弹层，有切换关闭效果的动画

在 React 中，组件删除，通常被立即删除，而没有动画，但可以使用 Framer Motion 和 GSAP 来实现退出动画，比如做打开关闭弹层，这类动画用 <strong>Framer Motion</strong> 更方便，因为它封装了一个 <strong>AnimatePresence</strong> 组件，而 GSAP 需要用 requestAnimationFrame 来判断下一帧的时候等 DOM 渲染好了，再执行动画。

[animation - exit](https://imber-animation.netlify.app/animations/exit/gsap)

<video src="/posts/animate/exit.mov" controls />

核心逻辑

```tsx
import { AnimatePresence, motion } from 'framer-motion'
import { Button } from '@/components/ui/button'
import { X } from 'lucide-react'

const Framer = () => {
  const [open, setOpen] = useState(false)

  return (
    <AnimatePresence>
      {open && (
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 0.2 }}
          className="fixed inset-0 z-50 bg-black/60"
          onClick={() => setOpen(false)}
        >
          <motion.div
            initial={{
              opacity: 0,
              scale: 0.95,
              x: '-50%',
              y: '-48%'
            }}
            animate={{
              opacity: 1,
              scale: 1,
              x: '-50%',
              y: '-50%'
            }}
            exit={{
              opacity: 0,
              scale: 0.95,
              x: '-50%',
              y: '-48%'
            }}
            transition={{ duration: 0.2, ease: 'easeOut' }}
            onClick={(e) => e.stopPropagation()}
          ></motion.div>
        </motion.div>
      )}
    </AnimatePresence>
  )
}
```

### 布局动画（Layout）

这个动画经常使用到，比如博客的主题切换按钮，正常的 flex 布局的切换是没有过渡效果的，使用 Framer Motion 提供的 layout 参数，可以实现布局切换的过渡效果。

[animation - layout](https://imber-animation.netlify.app/animations/layout)

<video src="/posts/animate/layout.mov" controls />

```tsx
'use client'

import { useTheme } from 'next-themes'
import { motion } from 'framer-motion'
import { Moon, Sun } from 'lucide-react'
import { useState, useEffect, useCallback } from 'react'

export function ModeToggle() {
  const { theme, setTheme } = useTheme()
  const [mounted, setMounted] = useState(false)
  const [isTransitioning, setIsTransitioning] = useState(false)

  // 避免水合不匹配
  useEffect(() => {
    setMounted(true)
  }, [])

  const isDark = theme === 'dark'

  const handleToggle = useCallback(() => {
    // 防止快速连击
    if (isTransitioning) return

    setIsTransitioning(true)
    setTheme(isDark ? 'light' : 'dark')

    // 重置防抖状态
    setTimeout(() => {
      setIsTransitioning(false)
    }, 300)
  }, [isDark, setTheme, isTransitioning])

  if (!mounted) {
    return null
  }

  return (
    <button
      // 这里切换 justify-end 和 justify-start
      className={`relative box-content flex h-[20px] w-[40px] cursor-pointer rounded-[60px] p-[4px] transition-colors duration-300 ${
        isDark ? 'justify-end bg-gray-700 shadow-inner' : 'justify-start bg-blue-200 shadow-inner'
      } ${isTransitioning ? 'pointer-events-none' : ''}`}
      onClick={handleToggle}
      disabled={isTransitioning}
      aria-label={`切换到${isDark ? '浅色' : '深色'}模式`}
      role="switch"
      aria-checked={isDark}
    >
      <motion.div
        className={`flex h-[20px] w-[20px] items-center justify-center rounded-full text-2xl transition-colors duration-300 ${
          isDark ? 'bg-gray-800 text-yellow-200 shadow-lg' : 'bg-yellow-400 text-orange-600 shadow-lg'
        }`}
        // 自动处理布局变化
        layout
        transition={{
          // 指定动画类型为弹簧动画
          type: 'spring',
          // 设置动画的视觉感知持续时间为 0.2 秒
          visualDuration: 0.2,
          // 控制弹簧的弹跳强度
          bounce: 0.2
        }}
        // 确保这个元素不会阻挡点击事件
        style={{ pointerEvents: 'none' }}
      >
        {isDark ? <Moon className="h-3 w-3" /> : <Sun className="h-3 w-3" />}
      </motion.div>
    </button>
  )
}
```

### 布局动画 - Tab切换（Tab）

不同元素之间的切换状态，这里使用官方的 Demo，正常这个下划线是没有动画效果，加上 layoutId 和 id 后，可以实现动画过渡效果。

[animation - tab](https://imber-animation.netlify.app/animations/tab)

<video src="/posts/animate/tab.mov" controls />

核心逻辑

```tsx
{
  item === selectedTab ? (
    <motion.div
      className="absolute right-0 -bottom-0.5 left-0 h-0.5 bg-[#ff4132]"
      layoutId="underline"
      id="underline"
    />
  ) : null
}
```

### 基础滚动动画（Scroll）

GSAP 是基于 ScrollTrigger 插件来滚动动画，Framer Motion 是基于 useScroll 钩子，两者都可以实现滚动动画。

[animation - scroll](https://imber-animation.netlify.app/animations/scroll)

<video src="/posts/animate/scroll.mov" controls />

```tsx

```

核心逻辑

```tsx

```

### 滚动动画 + 淡入淡出（Fade）

### 滚动动画 + 钉在页面（Pin）

### 滚动动画 + 视差效果（Parallax）

也就是产生不同速率滚动效果，比如背景图片滚动速度不一样，或者文字滚动速度不一样。

### SVG 动画（SVG）

### 动画参考

- [魅族 20infinity](https://www.meizu.com/20infinity/summary)
- [魅族 21pro](https://www.meizu.com/21pro/summary)
- [魅族 领克Z10 starbuff](https://www.xjmzstarauto.com/starbuff)
- [oppo find n5](https://www.oppo.com/cn/smartphones/series-find-n/find-n5/)
- [uiverse](https://uiverse.io/)
- [reactbits](https://www.reactbits.dev/)

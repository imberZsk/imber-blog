import { CodeSandbox } from '@/components/CodeSandbox'

## this 指向

### 题目 1：全局环境中的 this

<Sandpack>

```js
import { useState } from 'react'

export default function GlobalThisDemo() {
  const [result, setResult] = useState('')
  function handleClick() {
    setResult(typeof window !== 'undefined' ? (this === window ? 'true' : 'false') : '非浏览器环境')
  }
  return (
    <div>
      <button onClick={handleClick}>测试全局 this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 2：普通函数调用

<Sandpack>

```js
import { useState } from 'react'

export default function NormalFuncDemo() {
  const [result, setResult] = useState('')
  function test() {
    setResult(this)
  }
  return (
    <div>
      <button onClick={test}>测试普通函数 this</button>
      <div>结果：{String(result)}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 3：对象方法调用

<Sandpack>

```js
import { useState } from 'react'

export default function ObjectMethodDemo() {
  const [result, setResult] = useState('')
  const obj = {
    name: 'Alice',
    greet: function () {
      setResult(`Hello, ${this.name}`)
    }
  }
  return (
    <div>
      <button onClick={obj.greet}>测试对象方法 this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 4：嵌套对象方法

<Sandpack>

```js
import { useState } from 'react'

export default function NestedObjectMethodDemo() {
  const [result, setResult] = useState('')
  const obj = {
    name: 'Bob',
    outer: function () {
      function inner() {
        setResult(this?.name)
      }
      inner()
    }
  }
  return (
    <div>
      <button onClick={obj.outer}>测试嵌套对象方法 this</button>
      <div>结果：{String(result)}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 5：箭头函数

<Sandpack>

```js
import { useState } from 'react'

export default function ArrowFuncDemo() {
  const [result, setResult] = useState('')
  const obj = {
    name: 'Charlie',
    greet: () => {
      setResult(`Hello, ${this?.name}`)
    }
  }
  return (
    <div>
      <button onClick={obj.greet}>测试箭头函数 this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 6：构造函数

<Sandpack>

```js
import { useState } from 'react'

export default function ConstructorDemo() {
  const [result, setResult] = useState('')
  function Person(name) {
    this.name = name
  }
  function handleClick() {
    const person = new Person('David')
    setResult(person.name)
  }
  return (
    <div>
      <button onClick={handleClick}>测试构造函数 this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 7：call/apply 改变 this

<Sandpack>

```js
import { useState } from 'react'

export default function CallApplyDemo() {
  const [result, setResult] = useState('')
  const obj1 = { name: 'Eve' }
  const obj2 = { name: 'Frank' }
  function showName() {
    setResult(this.name)
  }
  function handleClick() {
    showName.call(obj1)
    setTimeout(() => showName.apply(obj2), 100)
  }
  return (
    <div>
      <button onClick={handleClick}>测试 call/apply this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 8：bind 方法

<Sandpack>

```js
import { useState } from 'react'

export default function BindDemo() {
  const [result, setResult] = useState('')
  const obj = {
    name: 'Grace',
    greet: function () {
      setTimeout(
        function () {
          setResult(`Hello, ${this.name}`)
        }.bind(this),
        100
      )
    }
  }
  return (
    <div>
      <button onClick={obj.greet}>测试 bind this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 9：DOM 事件处理函数

<CodeSandbox code={`<button id="myBtn">Click me</button>
<script>
  document.getElementById('myBtn').addEventListener('click', function () {
    console.log(this) // 点击按钮时输出什么？
  })
</script>

// 输出 button`} />

### 题目 10：类中的 this

<Sandpack>

```js
import { useState } from 'react'

export default function ClassThisDemo() {
  const [result, setResult] = useState('')
  class Person {
    constructor(name) {
      this.name = name
    }
    greet() {
      setResult(`Hello, ${this.name}`)
    }
  }
  function handleClick() {
    const person = new Person('Henry')
    person.greet()
  }
  return (
    <div>
      <button onClick={handleClick}>测试类 this</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 11：箭头函数中的 this

<CodeSandbox code={`const obj = {
  name: 'Ivy',
  greet: function () {
    setTimeout(function () {
      console.log(\`Hello, \${this.name}\`)
    }, 100)
  }
}
obj.greet() // 输出什么？

// 输出 Hello, undefined`} />

### 题目 12：箭头函数解决 this 问题

<Sandpack>

```js
import { useState } from 'react'

export default function ArrowThisDemo() {
  const [result, setResult] = useState('')
  const obj = {
    name: 'Jack',
    greet: function () {
      setTimeout(() => {
        setResult(`Hello, ${this.name}`)
      }, 100)
    }
  }
  return (
    <div>
      <button onClick={obj.greet}>测试箭头函数 this 2</button>
      <div>结果：{result}</div>
    </div>
  )
}
```

</Sandpack>

### 题目 13：严格模式下的 this

<CodeSandbox code={`'use strict'
function test() {
  console.log(this)
}
test() // 输出什么？

// 输出 undefined`} />

### 题目 14：多层嵌套的 this

<CodeSandbox code={`const obj = {
  name: 'Kate',
  outer: function () {
    const inner = () => {
      console.log(this.name)
    }
    inner()
  }
}
obj.outer() // 输出什么？

// 输出 Kate`} />

### 题目 15：方法作为回调函数

<CodeSandbox code={`const obj = {
  name: 'Liam',
  greet: function () {
    console.log(\`Hello, \${this.name}\`)
  }
}

setTimeout(obj.greet, 100) // 输出什么？

// 输出 Hello, undefined`} />

import { CodeSandbox } from '@/components/CodeSandbox'

## Promise 打印执行顺序

### 题目 1：async/await

<Sandpack>

```js
import { useState } from 'react'

export default function AsyncAwaitDemo() {
  const [logs, setLogs] = useState([])

  function log(msg) {
    setLogs((prev) => [...prev, msg])
  }

  async function async1() {
    log('async1 start')
    await async2()
    log('async1 end')
  }
  async function async2() {
    log('async2')
  }

  function handleClick() {
    setLogs([])
    log('script start')
    setTimeout(() => log('setTimeout'), 0)
    async1()
    new Promise((resolve) => {
      log('promise1')
      resolve()
    }).then(() => {
      log('promise2')
    })
    log('script end')
  }

  return (
    <div>
      <button onClick={handleClick}>执行 async/await 顺序</button>
      <div>输出：</div>
      <pre>{logs.join('\n')}</pre>
    </div>
  )
}
```

</Sandpack>

### 题目 2：resolve

<Sandpack>

```js
import { useState } from 'react'

export default function ResolveDemo() {
  const [logs, setLogs] = useState([])
  function log(msg) {
    setLogs((prev) => [...prev, msg])
  }
  function handleClick() {
    setLogs([])
    log('1')
    setTimeout(() => log('2'), 10)
    new Promise((resolve) => {
      log('3')
      resolve()
      log('4')
    }).then(() => log('5'))
    setTimeout(() => log('6'), 0)
    log('7')
  }
  return (
    <div>
      <button onClick={handleClick}>执行 resolve 顺序</button>
      <div>输出：</div>
      <pre>{logs.join('\n')}</pre>
    </div>
  )
}
```

</Sandpack>

### 题目 3：then

<Sandpack>

```js
import { useState } from 'react'

export default function ThenDemo() {
  const [logs, setLogs] = useState([])
  function log(msg) {
    setLogs((prev) => [...prev, msg])
  }
  async function async1() {
    log('async1 start')
    await async2()
    log('async1 middle')
    await async3()
    log('async1 end')
  }
  async function async2() {
    log('async2')
  }
  async function async3() {
    log('async3')
  }
  function handleClick() {
    setLogs([])
    log('script start')
    setTimeout(() => log('setTimeout'), 0)
    async1()
    new Promise((resolve) => {
      log('promise1')
      resolve(1)
    })
      .then((res) => {
        log('promise2 ' + res)
        return Promise.resolve(2)
      })
      .then((res) => {
        log('promise3 ' + res)
      })
    log('script end')
  }
  return (
    <div>
      <button onClick={handleClick}>执行 then 顺序</button>
      <div>输出：</div>
      <pre>{logs.join('\n')}</pre>
    </div>
  )
}
```

</Sandpack>

### 题目 4：Promise.all

<Sandpack>

```js
import { useState } from 'react'

export default function PromiseAllDemo() {
  const [logs, setLogs] = useState([])
  function log(msg) {
    setLogs((prev) => [...prev, msg])
  }
  function handleClick() {
    setLogs([])
    log('start')
    Promise.all([
      new Promise((resolve) => {
        setTimeout(() => {
          log('promise1')
          resolve(1)
        }, 2000)
      }),
      new Promise((resolve) => {
        setTimeout(() => {
          log('promise2')
          resolve(2)
        }, 1000)
      })
    ]).then((res) => {
      log('all done ' + JSON.stringify(res))
    })
    log('end')
  }
  return (
    <div>
      <button onClick={handleClick}>执行 Promise.all 顺序</button>
      <div>输出：</div>
      <pre>{logs.join('\n')}</pre>
    </div>
  )
}
```

</Sandpack>

### 题目 5：事件循环

<Sandpack>

```js
import { useState } from 'react'

export default function EventLoopDemo() {
  const [logs, setLogs] = useState([])
  function log(msg) {
    setLogs((prev) => [...prev, msg])
  }
  function handleClick() {
    setLogs([])
    log('1')
    setTimeout(() => {
      log('2')
      Promise.resolve().then(() => log('3'))
    }, 0)
    new Promise((resolve) => {
      log('4')
      resolve()
    }).then(() => {
      log('5')
      setTimeout(() => log('6'), 0)
    })
    Promise.resolve().then(() => log('7'))
    log('8')
  }
  return (
    <div>
      <button onClick={handleClick}>执行事件循环顺序</button>
      <div>输出：</div>
      <pre>{logs.join('\n')}</pre>
    </div>
  )
}
```

</Sandpack>
